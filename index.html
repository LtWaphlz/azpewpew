<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>IPew Attack Map — AZ DES</title>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<style>
  body { margin:0; padding:0; background:#000; color:#fff; }
  #titlediv {
    font-family: monospace; text-align:center; font-size:48px;
    position:fixed; width:100%; height:50px; color:#fff; background:#000;
    padding:5px; top:0; z-index:10; overflow-y:auto;
  }
  #attackdiv {
    font-family: monospace; font-size:10px;
    position:fixed; width:50%; height:100px; color:#fff; background:#000;
    padding:5px; bottom:0; z-index:10; overflow-y:auto; border-top:1px solid #222;
  }
  #container1 {
    position:relative; width:100vw; height:100vh; max-width:100%; max-height:100%;
  }
  #about { display:none; }
  #aboutdiv { text-align:right; width:100px; height:100px; top:0; right:0; position:fixed; padding:10px; color:#fff; z-index:12; }
  #ccdiv { text-align:right; width:100px; height:20px; bottom:0; right:0; position:fixed; padding:5px; color:#fff; z-index:12; }
  /* SimpleModal */
  #simplemodal-overlay { background-color:#000; }
  #simplemodal-container { height:460px; width:600px; color:#bbb; background:#333; border:4px solid #444; padding:12px; }
  #simplemodal-container .simplemodal-data { padding:8px; }
  #simplemodal-container code { background:#141414; border-left:3px solid #65B43D; color:#bbb; display:block; font-size:12px; margin-bottom:12px; padding:4px 6px 6px; }
  #simplemodal-container a { color:#ddd; }
  #simplemodal-container a.modalCloseImg { background:url(x.png) no-repeat; width:25px; height:29px; display:inline; z-index:3200; position:absolute; top:-15px; right:-18px; cursor:pointer; }
  #simplemodal-container h3 { color:#84b8d9; }
</style>

<!-- libs -->
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="https://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="jquery.simplemodal-1.4.4.js"></script>
<script>function about(){ $("#about").modal(); }</script>
</head>

<body>
  <!-- sounds -->
  <audio id="starwars" src="Blaster-Solo.wav" preload="auto"></audio>
  <audio id="tng" src="tng_torpedo_clean.mp3" preload="auto"></audio>
  <audio id="b5" src="B5-interceptor1.wav" preload="auto"></audio>
  <audio id="wargames" src="WarGames-KeyPress.wav" preload="auto"></audio>
  <audio id="pew" src="pew.mp3" preload="auto"></audio>
  <audio id="galaga" src="shot_sound.mp3" preload="auto"></audio>
  <audio id="asteroids" src="asteroids.mp3" preload="auto"></audio>
  <audio id="china" src="china.mp3" preload="auto"></audio>
  <audio id="timallen" src="timallen.wav" preload="auto"></audio>

  <center><div id="container1"></div></center>
  <div id="titlediv">IPew Attack Map</div>
  <div id="attackdiv"></div>
  <div id="aboutdiv"><i class="fa fa-question-circle fa-2x" onClick="about();"></i></div>

  <div id="ccdiv">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" />
    </a>
  </div>

  <!-- UPDATED: About modal content -->
  <div id="about">
    <h3>About this demo</h3>
    <p>
      This is a Norse/IPew‑style “pew‑pew” cyber attack map adapted for AZ DES leadership demos.
      Sources are sampled from global lists; with <code>drill_mode=1</code> all arcs land at a chosen
      Arizona location (Phoenix, Tucson, Mesa). It’s an executive‑awareness visualization, not a
      forensic tool. Colours/volume are illustrative, not incident counts.
    </p>
    <p>
      Controls: you can switch destinations by URL parameters (e.g., <code>drill_mode=1&lat=33.4484&lon=-112.0740</code>).
      For a dramatic demo, add <code>bad_day=1</code>. To silence effects, add <code>nofx=1</code>. This page can be embedded
      in a dashboard.
    </p>
    <p>
      Code from <a target=_blank href="https://github.com/hrbrmstr/pewpew">hrbrmstr/pewpew</a> with light UI text edits.
    </p>
  </div>

  <!-- keep the close anchor -->
  <a href="#!" class="modal-close" title="Close this modal"
      data-dismiss="modal" data-close="Close">&times;</a>

  <script>
    /* ===== ORIGINAL IPEW SCRIPT (unchanged) ===== */
    attack_min=100; attack_max=2000;

    attack_type=[ "any port scan in a storm","ssh brutish force","Thought Leader Tweet","SYN FLOOD BA-BY","Spotty","Heartbleed Hotel","Po_ODLE","Sharknado","CORGI Attack","Ping of DOOM","Conficker","Goldfinger","SANDPAPER","SNAILshock","Spaghetti RAT","Driduplex" ];
    audio_type=[ "starwars","tng","b5","wargames","pew","galaga","asteroids","china","timallen" ];

    $.extend({
      getUrlVars:function(){var vars=[],hash;var qPos=window.location.href.indexOf('?');var hashes=(qPos===-1)?[]:window.location.href.slice(qPos+1).split('&');for(var i=0;i<hashes.length;i++){hash=hashes[i].split('=');vars.push(hash[0]);vars[hash[0]]=hash[1];}return vars;},
      getUrlVar:function(name){return $.getUrlVars()[name];}
    });

    var norse_mode=$.getUrlVar('norse_mode');
    var bad_day=$.getUrlVar('bad_day');
    var org_name=$.getUrlVar('org_name');
    var chatt_mode=$.getUrlVar('chatt_mode');
    var china_mode=$.getUrlVar('china_mode');
    var dprk_mode=$.getUrlVar('dprk_mode');
    var employee_mode=$.getUrlVar('employee_mode');
    var employee_fname=$$.getUrlVar ? $.getUrlVar('employee_fname') : undefined;
    var employee_lname=$$.getUrlVar ? $.getUrlVar('employee_lname') : undefined;
    var origin=$.getUrlVar('origin');
    var random_mode=$.getUrlVar('random_mode');
    var tng=$.getUrlVar('tng');
    var wargames=$.getUrlVar('wargames');
    var b5=$.getUrlVar('b5');
    var nofx=$$.getUrlVar ? $.getUrlVar('nofx') : undefined;
    var pew=$$.getUrlVar ? $.getUrlVar('pew') : undefined;
    var allfx=$.getUrlVar('allfx');
    var galaga=$$.getUrlVar ? $.getUrlVar('galaga') : undefined;
    var asteroids=$$.getUrlVar ? $.getUrlVar('asteroids') : undefined;
    var china=$$.getUrlVar ? $.getUrlVar('china') : undefined;
    var timallen=$$.getUrlVar ? $.getUrlVar('timallen') : undefined;
    var drill_mode=$.getUrlVar('drill_mode');
    var in_lat=$.getUrlVar('lat');
    var in_lon=$.getUrlVar('lon');
    var destination=$.getUrlVar('destination');
    var greenattacks=$.getUrlVar('greenattacks');
    var redattacks=$.getUrlVar('redattacks');

    snd_id="starwars";
    if(typeof tng!=='undefined') snd_id="tng";
    if(typeof b5!=='undefined') snd_id="b5";
    if(typeof wargames!=='undefined') snd_id="wargames";
    if(typeof pew!=='undefined') snd_id="pew";
    if(typeof galaga!=='undefined') snd_id="galaga";
    if(typeof asteroids!=='undefined') snd_id="asteroids";
    if(typeof china!=='undefined') snd_id="china";
    if(typeof timallen!=='undefined') snd_id="timallen";

    if(typeof bad_day!=='undefined'){ attack_min=200; attack_max=200; }
    if(typeof org_name!=='undefined'){ $("#titlediv").text(decodeURI(org_name)+" IPew Attack Map").html(); }

    function FixedQueue(size,initialValues){initialValues=(initialValues||[]);var queue=Array.apply(null,initialValues);queue.fixedSize=size;queue.push=FixedQueue.push;queue.splice=FixedQueue.splice;queue.unshift=FixedQueue.unshift;FixedQueue.trimTail.call(queue);return(queue);}
    FixedQueue.trimHead=function(){if(this.length<=this.fixedSize){return;}Array.prototype.splice.call(this,0,(this.length-this.fixedSize));};
    FixedQueue.trimTail=function(){if(this.length<=this.fixedSize){return;}Array.prototype.splice.call(this,this.fixedSize,(this.length-this.fixedSize));};
    FixedQueue.wrapMethod=function(methodName,trimMethod){var wrapper=function(){var method=Array.prototype[methodName];var result=method.apply(this,arguments);trimMethod.call(this);return(result);};return(wrapper);};
    FixedQueue.push=FixedQueue.wrapMethod("push",FixedQueue.trimHead);
    FixedQueue.splice=FixedQueue.wrapMethod("splice",FixedQueue.trimTail);
    FixedQueue.unshift=FixedQueue.wrapMethod("unshift",FixedQueue.trimTail);

    var rand=function(min,max){return Math.random()*(max-min)+min;};
    function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
    function getOctet(){return Math.round(Math.random()*255);}
    function randomIP(){return(getOctet()+'.'+getOctet()+'.'+getOctet()+'.'+getOctet());}
    function getStroke(){return Math.round(Math.random()*100);}
    function getDestination(){return Math.round(Math.random()*100);}

    var countries=[9,22,29,49,56,58,78,82,102,117,139,176,186];
    var weight=[0.000,0.001,0.004,0.008,0.009,0.037,0.181,0.002,0.000,0.415,0.006,0.075,0.088];

    var map=new Datamap({
      scope:'world',
      element:document.getElementById('container1'),
      projection:'winkel3',
      fills:{ defaultFill:'black' },
      geographyConfig:{
        dataUrl:null, hideAntarctica:true, borderWidth:0.75, borderColor:'#4393c3',
        popupTemplate:function(geography,data){ return '<div class="hoverinfo" style="color:white;background:black">'+geography.properties.name+'</div>'; },
        popupOnHover:true, highlightOnHover:false, highlightFillColor:'black',
        highlightBorderColor:'rgba(250, 15, 160, 0.2)', highlightBorderWidth:2
      }
    });

    var centers=[]; var slatlong=[]; var cnlatlong=[];
    d3.tsv("country_centroids_primary.csv",function(data){ centers=data; });
    d3.csv("samplatlong.csv",function(data){ slatlong=data; });
    d3.csv("cnlatlong.csv",function(data){ cnlatlong=data; });

    var hits=FixedQueue(7,[]); var boom=FixedQueue(7,[]);

    var attacks={
      interval:getRandomInt(attack_min,attack_max),
      init:function(){ setTimeout(jQuery.proxy(this.getData,this), this.interval); },
      getData:function(){
        if(typeof norse_mode!=='undefined'){ return; }
        if(typeof random_mode!=='undefined'){ Math.floor((Math.random()*slatlong.length)); }
        dst=Math.floor((Math.random()*slatlong.length));
        src=Math.floor((Math.random()*slatlong.length));
        if(dst==src){ dst=src+1; if(dst>slatlong.length-1){ dst=src-1; } }
        if(typeof allfx!=='undefined'){ snd_id=audio_type[Math.floor((Math.random()*audio_type.length))]; }
        if(typeof nofx==='undefined'){ document.getElementById(snd_id).load(); document.getElementById(snd_id).play(); }

        var srclat=slatlong[src].lat, srclong=slatlong[src].long;
        var dstlat=slatlong[dst].lat, dstlong=slatlong[dst].long;
        which_attack=attack_type[Math.floor((Math.random()*attack_type.length))];
        var srccountry=slatlong[src]["country"];

        if(typeof china_mode!=='undefined'){
          srclat=cnlatlong[src].lat; srclong=cnlatlong[src].long;
          if(cnlatlong[src].country=="chn"){ which_attack="ZOMGOSH CHINA!!!!!!"; }
          srccountry=cnlatlong[src]["country"];
        } else if(typeof dprk_mode!=='undefined'){
          srclat=39.0194; srclong=125.7381; which_attack="ZOMG NORTH KOREAZ!!!"; srccountry="kp";
        } else if(typeof chatt_mode!=='undefined'){
          srclat=
